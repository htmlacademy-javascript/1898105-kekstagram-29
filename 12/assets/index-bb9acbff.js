(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const Q=5e3;function Y(e,t){return e.length<=t}Y("проверяемая строка",20);function Z(e){const t=e.replaceAll(" ","").toLowerCase();let n="";for(let s=t.length-1;s>=0;s--)n+=t.at([s]);return t===n}Z("Лёша на полке клопа нашёл ");const x=(e,t)=>{const n=document.createElement("div");n.style.zIndex="100",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.right="0",n.style.padding="10px 3px",n.style.fontSize="30px",n.style.textAlign="center",n.style.backgroundColor=t,n.textContent=e,document.body.append(n),setTimeout(()=>{n.remove()},Q)};function ee(e){const t=e.toString();let n="";for(let s=0;s<t.length;s++)Number.isNaN(parseInt(t[s],10))||(n+=t[s]);return parseInt(n,10)}ee("ECMAScript 2022");const u=e=>e.key==="Escape",te="https://29.javascript.pages.academy/kekstagram",w={GET_DATA:"/data",SEND_DATA:"/"},A={GET:"GET",POST:"POST"},k={GET_DATA:"Не удалось загрузить данные. Попробуйте обновить страницу",SEND_DATA:"Не удалось отправить форму. Попробуйте ещё раз"},P=(e,t,n=A.GET,s=null)=>fetch(`${te}${e}`,{method:n,body:s}).then(o=>{if(!o.ok)throw new Error;return o.json()}).catch(()=>{throw new Error(t)}),ne=()=>P(w.GET_DATA,k.GET_DATA),oe=e=>P(w.SEND_DATA,k.SEND_DATA,A.POST,e),se=document.querySelector(".scale"),E=document.querySelector(".scale__control--value"),ce=document.querySelector(".img-upload__preview img"),l={STEP:25,MAX:100,MIN:25,DEFAULT:100};E.value=`${l.DEFAULT}%`;const N=e=>{ce.style.transform=`scale(${e/l.DEFAULT})`,E.value=`${e}%`},q=e=>{const n=parseInt(E.value,10)+l.STEP*e;n<l.MIN||n>l.MAX||N(n)},re=e=>{e.target.classList.contains("scale__control--smaller")?q(-1):e.target.classList.contains("scale__control--bigger")&&q(1)},I=()=>{N(l.DEFAULT)};se.addEventListener("click",re);const F=[{name:"none",filter:"none",min:0,max:100,step:1,unit:""},{name:"chrome",filter:"grayscale",min:0,max:1,step:.1,unit:""},{name:"sepia",filter:"sepia",min:0,max:1,step:.1,unit:""},{name:"marvin",filter:"invert",min:0,max:100,step:1,unit:"%"},{name:"phobos",filter:"blur",min:0,max:3,step:.1,unit:"px"},{name:"heat",filter:"brightness",min:1,max:3,step:.1,unit:""}],r=F[0];let i=r;const U=document.querySelector(".img-upload__preview img"),ie=document.querySelector(".effects"),S=document.querySelector(".effect-level__slider"),B=document.querySelector(".img-upload__effect-level"),ae=document.querySelector(".effect-level__value"),M=()=>i===r,le=()=>{B.classList.remove("hidden")},L=()=>{B.classList.add("hidden")},$=()=>{S.noUiSlider.updateOptions({range:{min:i.min,max:i.max},step:i.step,start:r.max}),le(),M()&&L()},de=e=>{e.target.classList.contains("effects__radio")&&(i=F.find(t=>t.name===e.target.value),U.className=`effects__preview--${i.name}`,$())},ue=()=>{const e=S.noUiSlider.get();U.style.filter=M()?r.filter:`${i.filter}(${e}${i.unit})`,ae.value=e},O=()=>{i=r,L(),$()};noUiSlider.create(S,{range:{min:r.min,max:r.max},start:r.max,step:r.step,connect:"lower"});L();ie.addEventListener("change",de);S.noUiSlider.on("update",ue);const me=5,pe=/^#[a-zа-яё0-9]{1,19}$/i,G=document.querySelector("body"),ge=document.querySelector(".img-upload__input"),H=document.querySelector(".img-upload__overlay"),fe=document.querySelector(".img-upload__cancel"),g=document.querySelector(".img-upload__form"),h=g.querySelector(".text__hashtags"),ye=document.querySelector(".text__description"),_=document.querySelector(".img-upload__submit"),f=document.querySelector("#success").content.querySelector(".success"),y=document.querySelector("#error").content.querySelector(".error"),D=e=>{G.append(e)},d=e=>{e.remove()},K=()=>{H.classList.add("hidden"),document.body.classList.remove("modal-open")},V=e=>{u(e)&&(e.preventDefault(),d(f))},R=e=>{u(e)&&(e.preventDefault(),d(y))},z={IDLE:"Опубликовать",SENDING:"Публикую..."},m=new Pristine(g,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper"}),_e=()=>{_.disabled=!0,_.textContent=z.SENDING},Se=()=>{_.disabled=!1,_.textContent=z.IDLE},v=e=>e.trim().split(" ").filter(t=>!!t.length),he=e=>v(e).every(t=>pe.test(t)),Ee=e=>v(e).length<=me,Le=e=>{const t=v(e).map(n=>n.toLowerCase());return t.length===new Set(t).size};m.addValidator(h,Ee,"Много хештегов",3,!0);m.addValidator(h,Le,"Не уникальный хештег",1,!0);m.addValidator(h,he,"Не правильный хештег",2,!0);const ve=e=>{g.addEventListener("submit",t=>{t.preventDefault(),m.validate()?(_e(),D(f),oe(new FormData(t.target)).then(e).catch(s=>{x(s.message,"red")}).finally(Se)):(D(y),document.addEventListener("keydown",R))})},X=e=>{e.target.classList.contains("success__button")?(e.preventDefault(),d(f),document.removeEventListener("keydown",V)):e.target.classList.contains("error__button")||(d(y),document.removeEventListener("keydown",R))},Ce=e=>{e.target.classList.contains("success__inner")?e.target.classList.contains("error__inner")||d(y):d(f)},j=e=>{u(e)&&(e.preventDefault(),K(),O(),I(),g.reset(),m.reset())},qe=()=>{H.classList.remove("hidden"),G.classList.add("modal-open"),document.addEventListener("keydown",j)},W=()=>{K(),O(),I(),g.reset(),m.reset(),document.removeEventListener("keydown",j)},De=e=>{u(e)&&e.stopPropagation()},Te=e=>{u(e)&&e.stopPropagation()};ge.addEventListener("change",qe);fe.addEventListener("click",W);ye.addEventListener("keydown",De);h.addEventListener("keydown",Te);ve(W);f.addEventListener("click",X);y.addEventListener("click",X);document.addEventListener("click",Ce);document.addEventListener("keydown",V);const be=document.querySelector(".social__comments"),xe=document.querySelector("#comment").content.querySelector(".social__comment"),T=e=>{const t=document.createDocumentFragment();e.forEach(n=>{const s=xe.cloneNode(!0),o=s.querySelector(".social__picture");o.src=n.avatar,o.alt=n.name,s.querySelector(".social__text").textContent=n.message,t.append(s)}),be.append(t)},C=document.querySelector(".big-picture"),we=document.querySelector(".big-picture__img"),Ae=we.querySelector("img"),ke=document.querySelector(".social__caption"),Pe=document.querySelector(".likes-count"),Ne=document.querySelector(".big-picture__cancel"),Ie=document.querySelector(".comments-count"),p=document.querySelector(".comments-loader"),b=document.querySelector(".social__comment-count"),Fe=()=>{C.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open")},Ue=e=>{u(e)&&(e.preventDefault(),C.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open"))},Be=e=>{p.classList.remove("hidden"),document.body.classList.add("modal-open");let t=5;const{url:n,likes:s,comments:o,description:c}=e;o.length<=t&&(t=o.length,p.classList.add("hidden")),b.textContent=`${t} из ${o.length} комментариев`,C.classList.remove("hidden"),document.body.classList.add("modal-open"),Ae.src=n,ke.textContent=c,Pe.textContent=s,Ie.textContent=o.length,T(o.slice(0,t));const a=()=>{p.classList.remove("hidden"),document.querySelector(".social__comments").textContent="",t=t+5,t>=o.length&&(t=o.length,p.classList.add("hidden")),T(o.slice(0,t)),b.textContent=`${t} из ${o.length} комментариев`};p.addEventListener("click",a),Ne.addEventListener("click",Fe),document.addEventListener("keydown",Ue)},Me=document.querySelector(".pictures"),$e=document.querySelector("#picture").content,Oe=$e.querySelector("a"),Ge=e=>{const{url:t,likes:n,comments:s,description:o}=e,c=Oe.cloneNode(!0);c.querySelector(".picture__img").src=t,c.querySelector(".picture__img").alt=o,c.querySelector(".picture__comments").textContent=s.length,c.querySelector(".picture__likes").textContent=n;const a=J=>{J.preventDefault(),Be(e)};return c.addEventListener("click",a),c},He=e=>{const t=document.createDocumentFragment();e.forEach(n=>{t.append(Ge(n))}),Me.append(t)};ne().then(e=>{He(e)}).catch(e=>{x(e.message,"red")});
