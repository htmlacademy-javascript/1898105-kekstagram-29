(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const X=5e3;function j(e,t){return e.length<=t}j("проверяемая строка",20);function W(e){const t=e.replaceAll(" ","").toLowerCase();let n="";for(let c=t.length-1;c>=0;c--)n+=t.at([c]);return t===n}W("Лёша на полке клопа нашёл ");const J=(e,t)=>{const n=document.createElement("div");n.style.zIndex="100",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.right="0",n.style.padding="10px 3px",n.style.fontSize="30px",n.style.textAlign="center",n.style.backgroundColor=t,n.textContent=e,document.body.append(n),setTimeout(()=>{n.remove()},X)};function Q(e){const t=e.toString();let n="";for(let c=0;c<t.length;c++)Number.isNaN(parseInt(t[c],10))||(n+=t[c]);return parseInt(n,10)}Q("ECMAScript 2022");const m=e=>e.key==="Escape",Y="https://29.javascript.pages.academy/kekstagram",T={GET_DATA:"/data",SEND_DATA:"/"},x={GET:"GET",POST:"POST"},w={GET_DATA:"Не удалось загрузить данные. Попробуйте обновить страницу",SEND_DATA:"Не удалось отправить форму. Попробуйте ещё раз"},A=(e,t,n=x.GET,c=null)=>fetch(`${Y}${e}`,{method:n,body:c}).then(o=>{if(!o.ok)throw new Error;return o.json()}).catch(()=>{throw new Error(t)}),Z=()=>A(T.GET_DATA,w.GET_DATA),ee=e=>A(T.SEND_DATA,w.SEND_DATA,x.POST,e),te=document.querySelector(".scale"),_=document.querySelector(".scale__control--value"),ne=document.querySelector(".img-upload__preview img"),a={STEP:25,MAX:100,MIN:25,DEFAULT:100};_.value=`${a.DEFAULT}%`;const D=e=>{ne.style.transform=`scale(${e/a.DEFAULT})`,_.value=`${e}%`},v=e=>{const n=parseInt(_.value,10)+a.STEP*e;n<a.MIN||n>a.MAX||D(n)},oe=e=>{e.target.classList.contains("scale__control--smaller")?v(-1):e.target.classList.contains("scale__control--bigger")&&v(1)},k=()=>{D(a.DEFAULT)};te.addEventListener("click",oe);const P=[{name:"none",filter:"none",min:0,max:100,step:1,unit:""},{name:"chrome",filter:"grayscale",min:0,max:1,step:.1,unit:""},{name:"sepia",filter:"sepia",min:0,max:1,step:.1,unit:""},{name:"marvin",filter:"invert",min:0,max:100,step:1,unit:"%"},{name:"phobos",filter:"blur",min:0,max:3,step:.1,unit:"px"},{name:"heat",filter:"brightness",min:1,max:3,step:.1,unit:""}],r=P[0];let i=r;const N=document.querySelector(".img-upload__preview img"),ce=document.querySelector(".effects"),y=document.querySelector(".effect-level__slider"),I=document.querySelector(".img-upload__effect-level"),se=document.querySelector(".effect-level__value"),F=()=>i===r,re=()=>{I.classList.remove("hidden")},S=()=>{I.classList.add("hidden")},U=()=>{y.noUiSlider.updateOptions({range:{min:i.min,max:i.max},step:i.step,start:r.max}),re(),F()&&S()},ie=e=>{e.target.classList.contains("effects__radio")&&(i=P.find(t=>t.name===e.target.value),N.className=`effects__preview--${i.name}`,U())},le=()=>{const e=y.noUiSlider.get();N.style.filter=F()?r.filter:`${i.filter}(${e}${i.unit})`,se.value=e},B=()=>{i=r,S(),U()};noUiSlider.create(y,{range:{min:r.min,max:r.max},start:r.max,step:r.step,connect:"lower"});S();ce.addEventListener("change",ie);y.noUiSlider.on("update",le);const ae=document.querySelector("#success").content.querySelector(".success"),ue=document.querySelector("#error").content.querySelector(".error"),h=()=>{const e=document.querySelector(".error")||document.querySelector(".success");document.body.removeChild(e),document.removeEventListener("keydown",M,!0),document.removeEventListener("click",$)};function M(e){m(e)&&(e.stopPropagation(),h())}function $(e){e.target.closest(".success__inner")||h()}const H=(e,t)=>{document.body.append(e),document.addEventListener("keydown",M,!0),document.addEventListener("click",$),e.querySelector(t).addEventListener("click",h)},de=()=>H(ae,".success__button"),C=()=>H(ue,".error__button"),me=5,pe=/^#[a-zа-яё0-9]{1,19}$/i,ge=document.querySelector("body"),ye=document.querySelector(".img-upload__input"),O=document.querySelector(".img-upload__overlay"),fe=document.querySelector(".img-upload__cancel"),p=document.querySelector(".img-upload__form"),f=p.querySelector(".text__hashtags"),_e=document.querySelector(".text__description"),g=document.querySelector(".img-upload__submit"),G=()=>{O.classList.add("hidden"),document.body.classList.remove("modal-open")},V={IDLE:"Опубликовать",SENDING:"Публикую..."},u=new Pristine(p,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper"}),Se=()=>{g.disabled=!0,g.textContent=V.SENDING},he=()=>{g.disabled=!1,g.textContent=V.IDLE},E=e=>e.trim().split(" ").filter(t=>!!t.length),Ee=e=>E(e).every(t=>pe.test(t)),Le=e=>E(e).length<=me,ve=e=>{const t=E(e).map(n=>n.toLowerCase());return t.length===new Set(t).size};u.addValidator(f,Le,"Много хештегов",3,!0);u.addValidator(f,ve,"Не уникальный хештег",1,!0);u.addValidator(f,Ee,"Не правильный хештег",2,!0);const Ce=e=>{p.addEventListener("submit",t=>{t.preventDefault(),u.validate()?(Se(),de(),ee(new FormData(t.target)).then(e).catch(()=>{C()}).finally(he)):C()})},K=e=>{m(e)&&(e.preventDefault(),G(),B(),k(),p.reset(),u.reset())},qe=()=>{O.classList.remove("hidden"),ge.classList.add("modal-open"),document.addEventListener("keydown",K)},z=()=>{G(),B(),k(),p.reset(),u.reset(),document.removeEventListener("keydown",K)},be=e=>{m(e)&&e.stopPropagation()},Te=e=>{m(e)&&e.stopPropagation()};ye.addEventListener("change",qe);fe.addEventListener("click",z);_e.addEventListener("keydown",be);f.addEventListener("keydown",Te);Ce(z);const xe=document.querySelector(".social__comments"),we=document.querySelector("#comment").content.querySelector(".social__comment"),q=e=>{const t=document.createDocumentFragment();e.forEach(n=>{const c=we.cloneNode(!0),o=c.querySelector(".social__picture");o.src=n.avatar,o.alt=n.name,c.querySelector(".social__text").textContent=n.message,t.append(c)}),xe.append(t)},L=document.querySelector(".big-picture"),Ae=document.querySelector(".big-picture__img"),De=Ae.querySelector("img"),ke=document.querySelector(".social__caption"),Pe=document.querySelector(".likes-count"),Ne=document.querySelector(".big-picture__cancel"),Ie=document.querySelector(".comments-count"),d=document.querySelector(".comments-loader"),b=document.querySelector(".social__comment-count"),Fe=()=>{L.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open")},Ue=e=>{m(e)&&(e.preventDefault(),L.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open"))},Be=e=>{d.classList.remove("hidden"),document.body.classList.add("modal-open");let t=5;const{url:n,likes:c,comments:o,description:s}=e;o.length<=t&&(t=o.length,d.classList.add("hidden")),b.textContent=`${t} из ${o.length} комментариев`,L.classList.remove("hidden"),document.body.classList.add("modal-open"),De.src=n,ke.textContent=s,Pe.textContent=c,Ie.textContent=o.length,q(o.slice(0,t));const l=()=>{d.classList.remove("hidden"),document.querySelector(".social__comments").textContent="",t=t+5,t>=o.length&&(t=o.length,d.classList.add("hidden")),q(o.slice(0,t)),b.textContent=`${t} из ${o.length} комментариев`};d.addEventListener("click",l),Ne.addEventListener("click",Fe),document.addEventListener("keydown",Ue)},Me=document.querySelector(".pictures"),$e=document.querySelector("#picture").content,He=$e.querySelector("a"),Oe=e=>{const{url:t,likes:n,comments:c,description:o}=e,s=He.cloneNode(!0);s.querySelector(".picture__img").src=t,s.querySelector(".picture__img").alt=o,s.querySelector(".picture__comments").textContent=c.length,s.querySelector(".picture__likes").textContent=n;const l=R=>{R.preventDefault(),Be(e)};return s.addEventListener("click",l),s},Ge=e=>{const t=document.createDocumentFragment();e.forEach(n=>{t.append(Oe(n))}),Me.append(t)};Z().then(e=>{Ge(e)}).catch(e=>{J(e.message,"red")});
