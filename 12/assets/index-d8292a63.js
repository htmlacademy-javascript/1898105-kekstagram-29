(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const H=5e3;function M(e,t){return e.length<=t}M("проверяемая строка",20);function V(e){const t=e.replaceAll(" ","").toLowerCase();let n="";for(let c=t.length-1;c>=0;c--)n+=t.at([c]);return t===n}V("Лёша на полке клопа нашёл ");const x=(e,t)=>{const n=document.createElement("div");n.style.zIndex="100",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.right="0",n.style.padding="10px 3px",n.style.fontSize="30px",n.style.textAlign="center",n.style.backgroundColor=t,n.textContent=e,document.body.append(n),setTimeout(()=>{n.remove()},H)};function K(e){const t=e.toString();let n="";for(let c=0;c<t.length;c++)Number.isNaN(parseInt(t[c],10))||(n+=t[c]);return parseInt(n,10)}K("ECMAScript 2022");const p=e=>e.key==="Escape",z="https://29.javascript.pages.academy/kekstagram",b={GET_DATA:"/data",SEND_DATA:"/"},A={GET:"GET",POST:"POST"},D={GET_DATA:"Не удалось загрузить данные. Попробуйте обновить страницу",SEND_DATA:"Не удалось отправить форму. Попробуйте ещё раз"},w=(e,t,n=A.GET,c=null)=>fetch(`${z}${e}`,{method:n,body:c}).then(o=>{if(!o.ok)throw new Error;return o.json()}).catch(()=>{throw new Error(t)}),R=()=>w(b.GET_DATA,D.GET_DATA),P=e=>w(b.SEND_DATA,D.SEND_DATA,A.POST,e),X=5,j=/^#[a-zа-яё0-9]{1,19}$/i,W=document.querySelector("body"),J=document.querySelector(".img-upload__input "),_=document.querySelector(".img-upload__overlay"),Q=document.querySelector(".img-upload__cancel"),g=document.querySelector(".img-upload__form"),f=g.querySelector(".text__hashtags"),Y=document.querySelector(".text__description"),m=document.querySelector(".img-upload__submit"),k={IDLE:"Опубликовать",SENDING:"Публикую..."},u=new Pristine(g,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper"}),Z=()=>{m.disabled=!0,m.textContent=k.SENDING},ee=()=>{m.disabled=!1,m.textContent=k.IDLE},S=e=>e.trim().split(" ").filter(t=>!!t.length),te=e=>S(e).every(t=>j.test(t)),ne=e=>S(e).length<=X,oe=e=>{const t=S(e).map(n=>n.toLowerCase());return t.length===new Set(t).size};u.addValidator(f,ne,"Много хештегов",3,!0);u.addValidator(f,oe,"Не уникальный хештег",1,!0);u.addValidator(f,te,"Не правильный хештег",2,!0);const ce=e=>{g.addEventListener("submit",t=>{t.preventDefault(),u.validate()&&(Z(),P(new FormData(t.target)).then(e).catch(c=>{x(c.message,"red")}).finally(ee))})},h=e=>{p(e)&&(e.preventDefault(),_.classList.add("hidden"),document.body.classList.remove("modal-open"))},se=()=>{_.classList.remove("hidden"),W.classList.add("modal-open"),document.addEventListener("keydown",h)},N=()=>{_.classList.add("hidden"),document.body.classList.remove("modal-open"),g.reset(),u.reset(),document.removeEventListener("keydown",h)},re=e=>{p(e)&&e.stopPropagation()},ie=e=>{p(e)&&e.stopPropagation()};J.addEventListener("change",se);Q.addEventListener("click",N);document.addEventListener("keydown",h);Y.addEventListener("keydown",re);f.addEventListener("keydown",ie);ce(N);const ae=document.querySelector(".social__comments"),le=document.querySelector("#comment").content.querySelector(".social__comment"),C=e=>{const t=document.createDocumentFragment();e.forEach(n=>{const c=le.cloneNode(!0),o=c.querySelector(".social__picture");o.src=n.avatar,o.alt=n.name,c.querySelector(".social__text").textContent=n.message,t.append(c)}),ae.append(t)},E=document.querySelector(".big-picture"),de=document.querySelector(".big-picture__img"),ue=de.querySelector("img"),me=document.querySelector(".social__caption"),pe=document.querySelector(".likes-count"),ge=document.querySelector(".big-picture__cancel"),fe=document.querySelector(".comments-count"),d=document.querySelector(".comments-loader"),q=document.querySelector(".social__comment-count"),ye=()=>{E.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open")},_e=e=>{p(e)&&(e.preventDefault(),E.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open"))},Se=e=>{d.classList.remove("hidden");let t=5;const{url:n,likes:c,comments:o,description:s}=e;o.length<=t&&(t=o.length,d.classList.add("hidden")),q.textContent=`${t} из ${o.length} комментариев`,E.classList.remove("hidden"),document.body.classList.add("modal-open"),ue.src=n,me.textContent=s,pe.textContent=c,fe.textContent=o.length,C(o.slice(0,t));const a=()=>{d.classList.remove("hidden"),document.querySelector(".social__comments").textContent="",t=t+5,t>=o.length&&(t=o.length,d.classList.add("hidden")),C(o.slice(0,t)),q.textContent=`${t} из ${o.length} комментариев`};d.addEventListener("click",a),ge.addEventListener("click",ye),document.addEventListener("keydown",_e)},he=document.querySelector(".pictures"),Ee=document.querySelector("#picture").content,Le=Ee.querySelector("a"),ve=e=>{const{url:t,likes:n,comments:c,description:o}=e,s=Le.cloneNode(!0);s.querySelector(".picture__img").src=t,s.querySelector(".picture__img").alt=o,s.querySelector(".picture__comments").textContent=c.length,s.querySelector(".picture__likes").textContent=n;const a=G=>{G.preventDefault(),Se(e)};return s.addEventListener("click",a),s},Ce=e=>{const t=document.createDocumentFragment();e.forEach(n=>{t.append(ve(n))}),he.append(t)},I=[{name:"none",filter:"none",min:0,max:100,step:1,unit:""},{name:"chrome",filter:"grayscale",min:0,max:1,step:.1,unit:""},{name:"sepia",filter:"sepia",min:0,max:1,step:.1,unit:""},{name:"marvin",filter:"invert",min:0,max:100,step:1,unit:"%"},{name:"phobos",filter:"blur",min:0,max:3,step:.1,unit:"px"},{name:"heat",filter:"brightness",min:1,max:3,step:.1,unit:""}],r=I[0];let i=r;const F=document.querySelector(".img-upload__preview img"),qe=document.querySelector(".effects"),y=document.querySelector(".effect-level__slider"),U=document.querySelector(".img-upload__effect-level"),Te=document.querySelector(".effect-level__value"),B=()=>i===r,xe=()=>{U.classList.remove("hidden")},L=()=>{U.classList.add("hidden")},$=()=>{y.noUiSlider.updateOptions({range:{min:i.min,max:i.max},step:i.step,start:r.max}),xe(),B()&&L()},be=e=>{e.target.classList.contains("effects__radio")&&(i=I.find(t=>t.name===e.target.value),F.className=`effects__preview--${i.name}`,$())},Ae=()=>{const e=y.noUiSlider.get();F.style.filter=B()?r.filter:`${i.filter}(${e}${i.unit})`,Te.value=e},De=()=>{i=r,L(),$()};noUiSlider.create(y,{range:{min:r.min,max:r.max},start:r.max,step:r.step,connect:"lower"});L();qe.addEventListener("change",be);y.noUiSlider.on("update",Ae);const we=document.querySelector(".scale"),v=document.querySelector(".scale__control--value"),Pe=document.querySelector(".img-upload__preview img"),l={STEP:25,MAX:100,MIN:25,DEFAULT:100};v.value=`${l.DEFAULT}%`;const O=e=>{Pe.style.transform=`scale(${e/l.DEFAULT})`,v.value=`${e}%`},T=e=>{const n=parseInt(v.value,10)+l.STEP*e;n<l.MIN||n>l.MAX||O(n)},ke=e=>{e.target.classList.contains("scale__control--smaller")?T(-1):e.target.classList.contains("scale__control--bigger")&&T(1)},Ne=()=>{O(l.DEFAULT)};we.addEventListener("click",ke);Ne();De();P();R().then(e=>{Ce(e)}).catch(e=>{x(e.message,"red")});
