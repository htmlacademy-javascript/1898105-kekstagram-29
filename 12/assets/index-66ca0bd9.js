(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const G=5e3;function H(e,t){return e.length<=t}H("проверяемая строка",20);function M(e){const t=e.replaceAll(" ","").toLowerCase();let n="";for(let c=t.length-1;c>=0;c--)n+=t.at([c]);return t===n}M("Лёша на полке клопа нашёл ");const x=(e,t)=>{const n=document.createElement("div");n.style.zIndex="100",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.right="0",n.style.padding="10px 3px",n.style.fontSize="30px",n.style.textAlign="center",n.style.backgroundColor=t,n.textContent=e,document.body.append(n),setTimeout(()=>{n.remove()},G)};function V(e){const t=e.toString();let n="";for(let c=0;c<t.length;c++)Number.isNaN(parseInt(t[c],10))||(n+=t[c]);return parseInt(n,10)}V("ECMAScript 2022");const p=e=>e.key==="Escape",K="https://29.javascript.pages.academy/kekstagram",b={GET_DATA:"/data",SEND_DATA:"/"},A={GET:"GET",POST:"POST"},D={GET_DATA:"Не удалось загрузить данные. Попробуйте обновить страницу",SEND_DATA:"Не удалось отправить форму. Попробуйте ещё раз"},w=(e,t,n=A.GET,c=null)=>fetch(`${K}${e}`,{method:n,body:c}).then(o=>{if(!o.ok)throw new Error;return o.json()}).catch(()=>{throw new Error(t)}),z=()=>w(b.GET_DATA,D.GET_DATA),R=e=>w(b.SEND_DATA,D.SEND_DATA,A.POST,e),X=document.querySelector(".scale"),_=document.querySelector(".scale__control--value"),j=document.querySelector(".img-upload__preview img"),l={STEP:25,MAX:100,MIN:25,DEFAULT:100};_.value=`${l.DEFAULT}%`;const P=e=>{j.style.transform=`scale(${e/l.DEFAULT})`,_.value=`${e}%`},C=e=>{const n=parseInt(_.value,10)+l.STEP*e;n<l.MIN||n>l.MAX||P(n)},W=e=>{e.target.classList.contains("scale__control--smaller")?C(-1):e.target.classList.contains("scale__control--bigger")&&C(1)},J=()=>{P(l.DEFAULT)};X.addEventListener("click",W);const k=[{name:"none",filter:"none",min:0,max:100,step:1,unit:""},{name:"chrome",filter:"grayscale",min:0,max:1,step:.1,unit:""},{name:"sepia",filter:"sepia",min:0,max:1,step:.1,unit:""},{name:"marvin",filter:"invert",min:0,max:100,step:1,unit:"%"},{name:"phobos",filter:"blur",min:0,max:3,step:.1,unit:"px"},{name:"heat",filter:"brightness",min:1,max:3,step:.1,unit:""}],r=k[0];let i=r;const N=document.querySelector(".img-upload__preview img"),Q=document.querySelector(".effects"),g=document.querySelector(".effect-level__slider"),I=document.querySelector(".img-upload__effect-level"),Y=document.querySelector(".effect-level__value"),F=()=>i===r,Z=()=>{I.classList.remove("hidden")},S=()=>{I.classList.add("hidden")},U=()=>{g.noUiSlider.updateOptions({range:{min:i.min,max:i.max},step:i.step,start:r.max}),Z(),F()&&S()},ee=e=>{e.target.classList.contains("effects__radio")&&(i=k.find(t=>t.name===e.target.value),N.className=`effects__preview--${i.name}`,U())},te=()=>{const e=g.noUiSlider.get();N.style.filter=F()?r.filter:`${i.filter}(${e}${i.unit})`,Y.value=e},ne=()=>{i=r,S(),U()};noUiSlider.create(g,{range:{min:r.min,max:r.max},start:r.max,step:r.step,connect:"lower"});S();Q.addEventListener("change",ee);g.noUiSlider.on("update",te);const oe=5,ce=/^#[a-zа-яё0-9]{1,19}$/i,se=document.querySelector("body"),re=document.querySelector(".img-upload__input "),h=document.querySelector(".img-upload__overlay"),ie=document.querySelector(".img-upload__cancel"),f=document.querySelector(".img-upload__form"),y=f.querySelector(".text__hashtags"),ae=document.querySelector(".text__description"),m=document.querySelector(".img-upload__submit"),B={IDLE:"Опубликовать",SENDING:"Публикую..."},u=new Pristine(f,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper"}),le=()=>{m.disabled=!0,m.textContent=B.SENDING},de=()=>{m.disabled=!1,m.textContent=B.IDLE},E=e=>e.trim().split(" ").filter(t=>!!t.length),ue=e=>E(e).every(t=>ce.test(t)),me=e=>E(e).length<=oe,pe=e=>{const t=E(e).map(n=>n.toLowerCase());return t.length===new Set(t).size};u.addValidator(y,me,"Много хештегов",3,!0);u.addValidator(y,pe,"Не уникальный хештег",1,!0);u.addValidator(y,ue,"Не правильный хештег",2,!0);const ge=e=>{f.addEventListener("submit",t=>{t.preventDefault(),u.validate()&&(le(),R(new FormData(t.target)).then(e).catch(c=>{x(c.message,"red")}).finally(de))})},L=e=>{p(e)&&(e.preventDefault(),h.classList.add("hidden"),document.body.classList.remove("modal-open"))},fe=()=>{h.classList.remove("hidden"),se.classList.add("modal-open"),document.addEventListener("keydown",L)},$=()=>{h.classList.add("hidden"),document.body.classList.remove("modal-open"),ne(),J(),f.reset(),u.reset(),document.removeEventListener("keydown",L)},ye=e=>{p(e)&&e.stopPropagation()},_e=e=>{p(e)&&e.stopPropagation()};re.addEventListener("change",fe);ie.addEventListener("click",$);document.addEventListener("keydown",L);ae.addEventListener("keydown",ye);y.addEventListener("keydown",_e);ge($);const Se=document.querySelector(".social__comments"),he=document.querySelector("#comment").content.querySelector(".social__comment"),q=e=>{const t=document.createDocumentFragment();e.forEach(n=>{const c=he.cloneNode(!0),o=c.querySelector(".social__picture");o.src=n.avatar,o.alt=n.name,c.querySelector(".social__text").textContent=n.message,t.append(c)}),Se.append(t)},v=document.querySelector(".big-picture"),Ee=document.querySelector(".big-picture__img"),Le=Ee.querySelector("img"),ve=document.querySelector(".social__caption"),Ce=document.querySelector(".likes-count"),qe=document.querySelector(".big-picture__cancel"),Te=document.querySelector(".comments-count"),d=document.querySelector(".comments-loader"),T=document.querySelector(".social__comment-count"),xe=()=>{v.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open")},be=e=>{p(e)&&(e.preventDefault(),v.classList.add("hidden"),document.querySelector(".social__comments").textContent="",document.body.classList.remove("modal-open"))},Ae=e=>{d.classList.remove("hidden");let t=5;const{url:n,likes:c,comments:o,description:s}=e;o.length<=t&&(t=o.length,d.classList.add("hidden")),T.textContent=`${t} из ${o.length} комментариев`,v.classList.remove("hidden"),document.body.classList.add("modal-open"),Le.src=n,ve.textContent=s,Ce.textContent=c,Te.textContent=o.length,q(o.slice(0,t));const a=()=>{d.classList.remove("hidden"),document.querySelector(".social__comments").textContent="",t=t+5,t>=o.length&&(t=o.length,d.classList.add("hidden")),q(o.slice(0,t)),T.textContent=`${t} из ${o.length} комментариев`};d.addEventListener("click",a),qe.addEventListener("click",xe),document.addEventListener("keydown",be)},De=document.querySelector(".pictures"),we=document.querySelector("#picture").content,Pe=we.querySelector("a"),ke=e=>{const{url:t,likes:n,comments:c,description:o}=e,s=Pe.cloneNode(!0);s.querySelector(".picture__img").src=t,s.querySelector(".picture__img").alt=o,s.querySelector(".picture__comments").textContent=c.length,s.querySelector(".picture__likes").textContent=n;const a=O=>{O.preventDefault(),Ae(e)};return s.addEventListener("click",a),s},Ne=e=>{const t=document.createDocumentFragment();e.forEach(n=>{t.append(ke(n))}),De.append(t)};z().then(e=>{Ne(e)}).catch(e=>{x(e.message,"red")});
